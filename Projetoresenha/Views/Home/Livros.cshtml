@model List<Projetoresenha.Models.LivroDto>

@{
    ViewData["Title"] = "Livros";
    var livros = Model ?? new List<Projetoresenha.Models.LivroDto>();
}


<section class="py-4">
    <div class="d-flex flex-wrap gap-2 align-items-center mb-3">
        <h2 class="m-0">Catálogo</h2>
        <span class="text-muted">(@livros.Count títulos)</span>
        <div class="ms-auto" style="min-width: 260px;">
            <div class="input-group">
                <span class="input-group-text">🔎</span>
                <input id="q" class="form-control" placeholder="Buscar por título..." />
            </div>
        </div>
    </div>

    <div class="d-flex flex-wrap gap-2 mb-3">
        <button class="btn btn-outline-secondary btn-sm filter" data-genre="*">Todos</button>
        <button class="btn btn-outline-secondary btn-sm filter" data-genre="Fantasia">Fantasia</button>
        <button class="btn btn-outline-secondary btn-sm filter" data-genre="Distopia">Distopia</button>
        <button class="btn btn-outline-secondary btn-sm filter" data-genre="Clássico">Clássico</button>
        <button class="btn btn-outline-secondary btn-sm filter" data-genre="Romance">Romance</button>
        <button class="btn btn-outline-secondary btn-sm filter" data-genre="Sátira">Sátira</button>
        <div class="ms-auto">
            <select id="sort" class="form-select form-select-sm">
                <option value="titulo">Ordenar: Título (A–Z)</option>
            </select>
        </div>
    </div>

    <div class="row g-4" id="grid">
        @foreach (var b in livros)
        {
            /*<div class="col-6 col-md-3" data-card data-title="@b.Titulo" data-genres="@b.Genero">
                <div class="card h-100 shadow-sm">
                    <div class="card-body d-flex flex-column">
                        <h6 class="mb-1">@b.Titulo</h6>
                        <small class="text-muted d-block mb-2">@b.Genero</small>
                        <div class="mt-auto">
                            <span class="badge text-bg-light border">@b.Genero</span>
                        </div>
                    </div>
                </div>
            </div>*/
            <div class="card h-100 shadow-sm">
                <div class="card-body d-flex flex-column">
                    <h6 class="mb-1">@b.Titulo</h6>
                    <small class="text-muted d-block mb-2">@b.Genero</small>
                    <div class="mt-auto">
                        <span class="badge text-bg-light border">@b.Genero</span>
                    </div>
                </div>
                <div class="card-footer bg-white border-0">
                    <a class="btn btn-outline-primary w-100"
                       asp-controller="Home"
                       asp-action="LivroDetalhes"
                       asp-route-id="@b.Pkid_livro">
                        Ver detalhes
                    </a>
                </div>
            </div>

        }

        @if (!livros.Any())
        {
            <div class="col-12 text-muted">
                Nenhum livro cadastrado ainda.
            </div>
        }
    </div>
</section>

@section Scripts {
    <script>
        (() => {
            const q = document.getElementById('q');
            const cards = [...document.querySelectorAll('[data-card]')];
            const filterBtns = [...document.querySelectorAll('.filter')];
            const sortSel = document.getElementById('sort');

            let genre = '*';

            function apply() {
                const term = (q.value || '').toLowerCase().trim();
                let list = cards.slice();

                // filtro por gênero
                if (genre !== '*') {
                    list = list.filter(c => (c.dataset.genres || '').toLowerCase().includes(genre.toLowerCase()));
                }

                // filtro por texto (título)
                if (term) {
                    list = list.filter(c => (c.dataset.title || '').toLowerCase().includes(term));
                }

                // ordenação (por título)
                list.sort((a, b) => (a.dataset.title || '').localeCompare(b.dataset.title || ''));

                const grid = document.getElementById('grid');
                cards.forEach(c => c.style.display = 'none');
                list.forEach(c => { c.style.display = ''; grid.appendChild(c); });
            }

            q?.addEventListener('input', apply);
            sortSel?.addEventListener('change', apply);

            filterBtns.forEach(btn => btn.addEventListener('click', () => {
                filterBtns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                genre = btn.dataset.genre;
                apply();
            }));

            document.querySelector('.filter[data-genre="*"]')?.classList.add('active');
            apply();
        })();
    </script>
}
